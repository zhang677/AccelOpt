{
  "name": "rmsnorm_h512",
  "op_type": "rmsnorm",
  "axes": {
    "batch_size": {
      "type": "var",
      "description": null
    },
    "hidden_size": {
      "type": "const",
      "value": 512,
      "description": null
    }
  },
  "inputs": {
    "hidden_states": {
      "shape": [
        "batch_size",
        "hidden_size"
      ],
      "dtype": "bfloat16",
      "description": null
    },
    "weight": {
      "shape": [
        "hidden_size"
      ],
      "dtype": "bfloat16",
      "description": null
    }
  },
  "outputs": {
    "output": {
      "shape": [
        "batch_size",
        "hidden_size"
      ],
      "dtype": "bfloat16",
      "description": null
    }
  },
  "reference": "import torch\n\n@torch.no_grad()\ndef run(hidden_states, weight):\n    batch_size, hidden_size = hidden_states.shape\n    # Check constants\n    assert hidden_size == 512\n\n    EPS = 1e-6\n\n    x = hidden_states.to(torch.float32)\n    inv_rms = torch.rsqrt(x.pow(2).mean(dim=-1, keepdim=True) + EPS)\n    y = (x * inv_rms) * weight.to(torch.float32)\n    return y.to(hidden_states.dtype)",
  "tags": [
    "status:verified",
    "model:deepseek-v3",
    "model:deepseek-r1"
  ],
  "description": "Root Mean Square Normalization with hidden_size=512. Captured from DeepSeek-V3/R1. Epsilon is fixed at 1e-6.",
  "constraints": null
}